library com.livecode.extensions.devore.macstatusmenu	use com.livecode.foreign	use com.livecode.objc	metadata title is "Mac Status Menu"	metadata author is "Trevor DeVore"	metadata version is "0.1.0"	private foreign handler ObjC_NSStatusBarSystemStatusBar() \				returns ObjcId binds to "objc:NSStatusBar.+systemStatusBar"	private foreign handler ObjC_NSStatusBarStatusItemWithLength(in pStatusBar as ObjcId, in pLength as CFloat) \				returns ObjcId binds to "objc:NSStatusBar.-statusItemWithLength:"	private foreign handler ObjC_NSStatusItemSetTitle(in pObj as ObjcId, in pMenuObj as ObjcId) \				returns nothing binds to "objc:NSStatusItem.-setTitle:"	private foreign handler ObjC_NSStatusItemSetMenu(in pObj as ObjcId, in pMenuObj as ObjcId) \				returns nothing binds to "objc:NSStatusItem.-setMenu:"	private foreign handler ObjC_NSStatusItemSetHighlightMode(in pObj as ObjcId, in pBoolean as CBool) \				returns nothing binds to "objc:NSStatusItem.-setHighlightMode:" // For pre-10.10	private foreign handler ObjC_NSStatusItemButton(in pObj as ObjcId) \				returns ObjcId binds to "objc:NSStatusItem.-button"	private foreign handler ObjC_NSButtonSetImage(in pObj as ObjcId, in pImage as ObjcId) \				returns nothing binds to "objc:NSButton.-setImage:"	private foreign handler ObjC_NSButtonSetAlternateImage(in pObj as ObjcId, in pImage as ObjcId) \				returns nothing binds to "objc:NSButton.-setAlternateImage:"	private foreign handler ObjC_NSImageAlloc() returns ObjcRetainedId binds to "objc:NSImage.+alloc"	private foreign handler ObjC_NSImageInitWithContentsOfFile(in pObj as ObjcId, in pFilename as ObjcId) \				returns ObjcId binds to "objc:NSImage.-initWithContentsOfFile:"	private foreign handler ObjC_NSImageSetTemplate(in pObj as ObjcId, in pBoolean as CBool) \				returns nothing binds to "objc:NSImage.-setTemplate:"	private foreign handler ObjC_NSMenuAlloc() \				returns ObjcRetainedId binds to "objc:NSMenu.+alloc"	private foreign handler ObjC_NSMenuInitWithTitle(in pObj as ObjcId, in pTitle as ObjcId) \				returns ObjcId binds to "objc:NSMenu.-initWithTitle:"	private foreign handler ObjC_NSMenuAddItem(in pObj as ObjcId, in pItem as ObjcId) \				returns nothing binds to "objc:NSMenu.-addItem:"	private foreign handler ObjC_NSMenuNumberOfItems(in pObj as ObjcId) \				returns CInt binds to "objc:NSMenu.-numberOfItems"	private foreign handler ObjC_NSMenuItemAlloc() \				returns ObjcRetainedId binds to "objc:NSMenuItem.+alloc"	private foreign handler ObjC_NSMenuItemInitWithTitle(in pObj as ObjcId, in pTitle as ObjcId, in pAction as optional ObjcId, in pKeyEquivalent as ObjcId) \				returns ObjcId binds to "objc:NSMenuItem.-initWithTitle:action:keyEquivalent:"	private foreign handler ObjC_NSMenuItemSetTarget(in pObj as ObjcId, in pTargetObjId as ObjcId) \				returns nothing binds to "objc:NSMenuItem.-setTarget:"	private constant kNSVariableStatusItemLength is -1.0	private constant kNSSquareStatusItemLength is -2.0	private variable mStatusMenu as optional ObjcObject	private variable mMenuItem as ObjcObject	private variable mStatusItem as ObjcObject	private variable mStatusImage as ObjcObject	public handler TestMyMenu(in pImagePath as String) returns nothing		variable tStatusMenu as optional ObjcObject		variable tMenuItem as optional ObjcObject		variable tStatusBar as ObjcObject		variable tStatusImage as ObjcObject		variable tStatusBarButton as ObjcObject		unsafe			// Create an NSStatusItem			put ObjC_NSStatusBarSystemStatusBar() into tStatusBar			put ObjC_NSStatusBarStatusItemWithLength(tStatusBar, kNSSquareStatusItemLength) into mStatusItem			// Create NSImage			put ObjC_NSImageAlloc() into tStatusImage			put ObjC_NSImageInitWithContentsOfFile(tStatusImage, StringToNSString(pImagePath)) into tStatusImage			ObjC_NSImageSetTemplate(tStatusImage, true)			put tStatusImage into mStatusImage			// Set NSStatusItem's NSButton properties			put ObjC_NSStatusItemButton(mStatusItem) into tStatusBarButton			ObjC_NSButtonSetImage(tStatusBarButton, mStatusImage)			ObjC_NSStatusItemSetHighlightMode(mStatusItem, true)			// Create status menu NSMenu			put ObjC_NSMenuAlloc() into tStatusMenu			put ObjC_NSMenuInitWithTitle(tStatusMenu, StringToNSString("LCB Menu")) into tStatusMenu			put tStatusMenu into mStatusMenu			// Create a menu item NSMenuItem			put ObjC_NSMenuItemAlloc() into tMenuItem			put ObjC_NSMenuItemInitWithTitle(tMenuItem, StringToNSString("Option 1"), nothing, StringToNSString("")) into tMenuItem			put tMenuItem into mMenuItem			ObjC_NSMenuItemSetTarget(mMenuItem, mStatusMenu)			// Add NSMenuItem to NSMenu			ObjC_NSMenuAddItem(mStatusMenu, mMenuItem)			// Assign NSMenu to NSStatusItem			ObjC_NSStatusItemSetMenu(mStatusItem, mStatusMenu)			// Check if image data is being read in properly			-- log NSImageToImageDataAsType(tStatusImage, nothing)		end unsafe	end handler	public handler CleanupMyMenu() returns nothing	  put nothing into mStatusMenu	end handler	public foreign type CGImageRef binds to "MCAggregateTypeInfo:r"	private foreign handler ObjC_NSImageRepresentations(in pImage as ObjcId) \        returns ObjcId binds to "objc:NSImage.-representations"  private foreign handler ObjC_NSImageRepGetCGImage(in pImageRep as ObjcId, in pContext as optional ObjcId, in pHints as optional ObjcId) \        returns CGImageRef binds to "objc:NSImageRep.-CGImageForProposedRect:context:hints:"  private foreign handler ObjC_NSBitmapImageRepAlloc() \        returns ObjcRetainedId binds to "objc:NSBitmapImageRep.+alloc"  private foreign handler ObjC_NSBitmapImageRepInitWithCGImage(in pImageRep as ObjcId, in pCGImageRef as CGImageRef) \        returns ObjcId binds to "objc:NSBitmapImageRep.-initWithCGImage:"  private foreign handler ObjC_NSBitmapImageRepRepresenatationUsingType(in pBitmapImageRep as ObjcId, in pType as CInt, in pProps as optional ObjcId) \        returns ObjcId binds to "objc:NSBitmapImageRep.-representationUsingType:properties:"	private handler NSImageToImageDataAsType(in pNSImage as ObjcObject, in pImageType as optional Number) returns Data		variable tImageReps as ObjcObject		variable tImageRepsList as List		variable tImageRep as ObjcObject		variable tBitmapImageRep as ObjcObject		variable tCGImageRef as CGImageRef		variable tImageData as ObjcObject		// Default to PNG		if pImageType is nothing then			put 4 into pImageType		end if		unsafe		  put ObjC_NSImageRepresentations(pNSImage) into tImageReps	    put ListFromNSArray(tImageReps) into tImageRepsList	    put element 1 of tImageRepsList into tImageRep	    put ObjC_NSImageRepGetCGImage(tImageRep, nothing, nothing) into tCGImageRef	    put ObjC_NSBitmapImageRepAlloc() into tBitmapImageRep	    put ObjC_NSBitmapImageRepInitWithCGImage(tBitmapImageRep, tCGImageRef) into tBitmapImageRep	    -- TIFF = 0	    -- BMP = 1	    -- GIF = 2	    -- JPEG = 3	    -- PNG = 4	    -- JPEG2000 = 5	    put ObjC_NSBitmapImageRepRepresenatationUsingType(tBitmapImageRep, pImageType, nothing) into tImageData		end unsafe    return DataFromNSData(tImageData)	end handlerend library